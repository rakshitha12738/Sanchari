<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Travel Guide</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      /* Olive Green Color Palette */
      --primary: #6B8E23;
      --primary-light: #8FBC3F;
      --primary-dark: #556B2F;
      --secondary: #9ACD32;
      --accent: #708238;
      
      /* Backgrounds */
      --bg-gradient-start: #F5F8F0;
      --bg-gradient-end: #E8F0DB;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.5);
      
      /* Text */
      --text-primary: #1E293B;
      --text-secondary: #64748B;
      
      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.12);
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      overflow-x: hidden;
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(107, 142, 35, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(112, 130, 56, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2.5rem;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      z-index: 1000;
      transition: background 0.3s ease;
    }
    
    nav.scrolled { 
      background: rgba(255, 255, 255, 0.95); 
    }

    nav h1 { 
      color: var(--primary); 
      font-size: 1.5rem; 
      letter-spacing: 1px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
    }
    
    .nav-links a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: color 0.3s;
      position: relative;
    }
    
    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      transition: width 0.3s ease;
    }
    
    .nav-links a:hover { 
      color: var(--primary); 
    }
    
    .nav-links a:hover::after {
      width: 100%;
    }

    .menu-toggle {
      display: none;
      flex-direction: column;
      cursor: pointer;
      background: none;
      border: none;
    }
    
    .menu-toggle span {
      height: 3px; 
      width: 25px; 
      background: var(--primary); 
      margin: 4px 0; 
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    @media (max-width: 768px) {
      nav {
        padding: 1rem 1.5rem;
      }
      
      .nav-links {
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        flex-direction: column;
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        padding: 1.5rem;
        gap: 1rem;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease;
        box-shadow: var(--shadow-lg);
      }
      
      .nav-links.open { 
        max-height: 400px; 
      }
      
      .menu-toggle { 
        display: flex; 
      }
    }

    header {
      height: 50vh;
      min-height: 400px;
      background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #fff;
      position: relative;
      margin-top: 70px;
    }

    header::after {
      content: '';
      position: absolute;
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%;
      background: linear-gradient(135deg, rgba(107, 142, 35, 0.6) 0%, rgba(112, 130, 56, 0.4) 100%);
      z-index: 0;
    }

    header h1, header p {
      position: relative;
      z-index: 1;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeUp 0.8s forwards;
    }
    
    header h1 { 
      font-size: 2.8rem; 
      animation-delay: 0.2s;
      font-weight: 700;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    header p { 
      font-size: 1.15rem; 
      margin-top: 0.75rem; 
      animation-delay: 0.4s;
      font-weight: 300;
      max-width: 600px;
      line-height: 1.6;
    }

    @keyframes fadeUp {
      to { opacity: 1; transform: translateY(0); }
    }

    .summary-section {
      background: linear-gradient(135deg, rgba(107, 142, 35, 0.1) 0%, rgba(112, 130, 56, 0.1) 100%);
      padding: 5rem 2rem;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    
    .summary-section h2 {
      font-size: 2.5rem;
      color: var(--text-primary);
      margin-bottom: 3rem;
      font-weight: 600;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      color: var(--text-primary);
      border-radius: 1rem;
      padding: 2.5rem 2rem;
      box-shadow: var(--shadow-md);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }
    
    .card p {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    .card button {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: #fff;
      border: none;
      padding: 0.75rem 1.75rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.95rem;
      box-shadow: var(--shadow-sm);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .section {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 4rem;
      padding: 5rem 2.5rem;
      max-width: 1200px;
      margin: 0 auto;
      opacity: 0;
      transform: translateY(40px);
      transition: all 0.8s ease;
      position: relative;
      z-index: 1;
    }
    
    .section.visible { 
      opacity: 1; 
      transform: translateY(0); 
    }

    .section:nth-child(even) { 
      background-color: transparent;
    }

    .section img {
      width: 100%;
      max-width: 500px;
      border-radius: 1.5rem;
      box-shadow: var(--shadow-lg);
      object-fit: cover;
      height: 350px;
    }

    .text { 
      max-width: 500px; 
    }
    
    .text h2 { 
      font-size: 2.2rem; 
      color: var(--text-primary); 
      margin-bottom: 1.5rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .text p { 
      color: var(--text-secondary); 
      line-height: 1.8;
      font-size: 1.05rem;
    }
    
    @media (max-width: 768px) {
      header h1 {
        font-size: 2.5rem;
      }
      
      header p {
        font-size: 1.1rem;
      }
      
      .summary-section {
        padding: 3rem 1.5rem;
      }
      
      .summary-section h2 {
        font-size: 2rem;
      }
      
      .section {
        padding: 3rem 1.5rem;
        gap: 2rem;
      }
      
      .text h2 {
        font-size: 1.8rem;
      }
      
      .section img {
        max-width: 100%;
        height: 280px;
      }
    }
  </style>
</head>
<body>
  <nav>
    <h1>SANCHARI</h1>
    <div class="menu-toggle" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>
    <div class="nav-links">
      <a href="index.html">üè† Home</a>
      <a href="#section1">History</a>
      <a href="#section2">Food</a>
      <a href="#section3">Adventure</a>
      <a href="#section4">Safety</a>
      <a href="#section5">Attractions</a>
      <a href="#" id="loginBtn">Login</a>
    </div>
  </nav>

  <header>
    <h1>Discover the World</h1>
    <p>Explore breathtaking places, flavors, and adventures across the globe.</p>
    <div style="margin-top: 2rem; position: relative; z-index: 100; text-align: center;">
      
    </div>
  </header>

  <section class="summary-section">
    <h2>At First Look</h2>
    <div class="cards">
      <div class="card"><h3>üèõÔ∏è History</h3><p>Step back in time and explore ancient wonders.</p><button onclick="scrollToSection(1)">Learn More</button></div>
      <div class="card"><h3>üç≤ Food</h3><p>Taste the culture through every delicious dish.</p><button onclick="scrollToSection(2)">Learn More</button></div>
      <div class="card"><h3>üåÑ Adventure</h3><p>Thrills and explorations that spark your soul.</p><button onclick="scrollToSection(3)">Learn More</button></div>
      <div class="card"><h3>üõ°Ô∏è Safety</h3><p>Smart tips for safe, stress-free travel.</p><button onclick="scrollToSection(4)">Learn More</button></div>
    </div>
  </section>

  <!-- Popular/Hidden Places Sections -->
  <section id="popularPlacesSection" style="display: none; padding: 3rem 2rem; background: linear-gradient(135deg, rgba(107, 142, 35, 0.05) 0%, rgba(112, 130, 56, 0.05) 100%);">
    <h2 style="text-align: center; font-size: 2.2rem; color: var(--text-primary); margin-bottom: 2rem;">Popular Places</h2>
    <div id="popularPlacesList" style="max-width: 1200px; margin: 0 auto;"></div>
  </section>
  
  <section id="hiddenPlacesSection" style="display: none; padding: 3rem 2rem; background: linear-gradient(135deg, rgba(112, 130, 56, 0.05) 0%, rgba(107, 142, 35, 0.05) 100%);">
    <h2 style="text-align: center; font-size: 2.2rem; color: var(--text-primary); margin-bottom: 2rem;">Hidden Places</h2>
    <div id="hiddenPlacesList" style="max-width: 1200px; margin: 0 auto;"></div>
  </section>

  <section class="section" id="section1">
    <img src="https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=800&q=80" alt="History" />
    <div class="text">
      <h2>Rich History</h2>
      <p>Every destination holds centuries of stories. Walk through ancient ruins and feel the heartbeat of civilizations that shaped our world.</p>
    </div>
  </section>

  <section class="section" id="section2">
    <div class="text">
      <h2>World of Flavors</h2>
      <p>From spicy street foods to elegant global cuisines, explore the tastes that define every culture. Each dish tells a story of tradition and creativity.</p>
    </div>
    <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80" alt="Food" />
  </section>

  <section class="section" id="section3">
    <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=80" alt="Adventure" />
    <div class="text">
      <h2>Adventure Awaits</h2>
      <p>Embrace your inner explorer. Whether hiking, diving, or paragliding, adventure connects you to the planet‚Äôs pulse and makes you feel alive.</p>
    </div>
  </section>

  <section class="section" id="section4">
    <div class="text">
      <h2>Travel Smart & Safe</h2>
      <p>Safety ensures joyful journeys. Stay mindful, respect customs, and keep essential contacts handy wherever you go.</p>
    </div>
    <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&w=800&q=80" alt="Safety Tips" />
  </section>

  <section class="section" id="section5">
    <img src="https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?auto=format&fit=crop&w=800&q=80" alt="Nearby Attractions" />
    <div class="text">
      <h2>Nearby Attractions</h2>
      <p>Every journey unveils hidden gems just around the corner. Discover nearby attractions ‚Äî serene lakes, local markets, historical landmarks, and breathtaking viewpoints that make your trip unforgettable.</p>
    </div>
  </section>

    <!-- User Menu -->
    <div id="userMenu" style="display: none; position: fixed; right: 20px; top: 70px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000;">
        <div style="padding: 15px; border-bottom: 1px solid #eee;">
            <strong id="userDisplayName"></strong>
        </div>
        <div style="padding: 15px;">
            <a href="#" onclick="handleLogout()" style="color: var(--primary); text-decoration: none;">Logout</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>
    <script>
    // Global error handler
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      // You could send this to a logging service
    });

    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      // Prevent the default browser behavior
      e.preventDefault();
    });

    // Immediate debug test
    console.log('JavaScript is running!');
    window.addEventListener('load', function() {
      console.log('Window loaded, testing button access...');
      const popularBtn = document.getElementById('popularBtn');
      const hiddenBtn = document.getElementById('hiddenBtn');
      console.log('Buttons found:', { popularBtn, hiddenBtn });
      
      if (popularBtn) {
        console.log('Popular button styles:', window.getComputedStyle(popularBtn));
      }
    });

    // Test functions for immediate button response
    function testPopularClick() {
      console.log('Popular button clicked directly via onclick');
      
      const popularSection = document.getElementById('popularPlacesSection');
      const hiddenSection = document.getElementById('hiddenPlacesSection');
      
      if (popularSection && hiddenSection) {
        popularSection.style.display = 'block';
        hiddenSection.style.display = 'none';
        
        setTimeout(() => {
          popularSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
        
        // Update button styling
        updateButtonStates('popular');
      } else {
        console.error('Sections not found:', { popularSection, hiddenSection });
      }
    }
    
    function testHiddenClick() {
      console.log('Hidden button clicked directly via onclick');
      
      const popularSection = document.getElementById('popularPlacesSection');
      const hiddenSection = document.getElementById('hiddenPlacesSection');
      
      if (popularSection && hiddenSection) {
        hiddenSection.style.display = 'block';
        popularSection.style.display = 'none';
        
        setTimeout(() => {
          hiddenSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
        
        // Update button styling
        updateButtonStates('hidden');
      } else {
        console.error('Sections not found:', { popularSection, hiddenSection });
      }
    }
    
    function updateButtonStates(active) {
      const popularBtn = document.getElementById('popularBtn');
      const hiddenBtn = document.getElementById('hiddenBtn');
      
      if (popularBtn && hiddenBtn) {
        if (active === 'popular') {
          popularBtn.style.background = 'linear-gradient(135deg, #6B8E23 0%, #9ACD32 100%)';
          hiddenBtn.style.background = 'linear-gradient(135deg, #ccc 0%, #999 100%)';
        } else {
          hiddenBtn.style.background = 'linear-gradient(135deg, #708238 0%, #6B8E23 100%)';
          popularBtn.style.background = 'linear-gradient(135deg, #ccc 0%, #999 100%)';
        }
      }
    }

    // Popular/Hidden Places Button Logic
    function initializeButtons() {
      const popularBtn = document.getElementById('popularBtn');
      const hiddenBtn = document.getElementById('hiddenBtn');
      const popularSection = document.getElementById('popularPlacesSection');
      const hiddenSection = document.getElementById('hiddenPlacesSection');
      
      console.log('Initializing buttons:', { popularBtn, hiddenBtn, popularSection, hiddenSection });
      
      if (popularBtn && hiddenBtn && popularSection && hiddenSection) {
        // Remove any existing event listeners
        popularBtn.replaceWith(popularBtn.cloneNode(true));
        hiddenBtn.replaceWith(hiddenBtn.cloneNode(true));
        
        // Get the new button references
        const newPopularBtn = document.getElementById('popularBtn');
        const newHiddenBtn = document.getElementById('hiddenBtn');
        
        newPopularBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Popular Places button clicked');
          
          // Check if section has content
          const popularContent = document.getElementById('popularPlacesList');
          if (!popularContent || popularContent.innerHTML.trim() === '') {
            console.log('No popular places content found');
            alert('Popular Places data is not available for this destination yet.');
            return;
          }
          
          this.style.transform = 'scale(0.95)';
          setTimeout(() => this.style.transform = 'scale(1)', 150);
          
          popularSection.style.display = 'block';
          hiddenSection.style.display = 'none';
          
          newPopularBtn.style.background = 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)';
          newHiddenBtn.style.background = 'linear-gradient(135deg, #ccc 0%, #999 100%)';
          
          setTimeout(() => {
            popularSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 200);
        });
        
        newHiddenBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Hidden Places button clicked');
          
          // Check if section has content
          const hiddenContent = document.getElementById('hiddenPlacesList');
          if (!hiddenContent || hiddenContent.innerHTML.trim() === '') {
            console.log('No hidden places content found');
            alert('Hidden Places data is not available for this destination yet.');
            return;
          }
          
          this.style.transform = 'scale(0.95)';
          setTimeout(() => this.style.transform = 'scale(1)', 150);
          
          hiddenSection.style.display = 'block';
          popularSection.style.display = 'none';
          
          newHiddenBtn.style.background = 'linear-gradient(135deg, var(--accent) 0%, var(--primary-dark) 100%)';
          newPopularBtn.style.background = 'linear-gradient(135deg, #ccc 0%, #999 100%)';
          
          setTimeout(() => {
            hiddenSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 200);
        });
        
        console.log('Button event listeners added successfully');
      } else {
        console.error('Could not find button elements:', { popularBtn, hiddenBtn, popularSection, hiddenSection });
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializeButtons();
    });

    // Check authentication on page load
    window.addEventListener('DOMContentLoaded', () => {
        const token = Cookies.get('token');
        if (!token) {
            // User is not logged in, redirect to login page
            window.location.href = 'login.html';
            return;
        }
        
        // User is logged in, show user name in navbar
        updateNavbarUser();
        
        // Load page content
        loadStates().then(() => {
            updateContent();
        });
    });

    function updateNavbarUser() {
        const userName = Cookies.get('userName');
        const loginBtn = document.getElementById('loginBtn');
        if (userName && loginBtn) {
            loginBtn.textContent = userName;
            loginBtn.onclick = function(e) {
                e.preventDefault();
                const userMenu = document.getElementById('userMenu');
                userMenu.style.display = userMenu.style.display === 'none' ? 'block' : 'none';
            };
            
            const userDisplayName = document.getElementById('userDisplayName');
            if (userDisplayName) {
                userDisplayName.textContent = userName;
            }
        }
    }

    function handleLogout() {
        Cookies.remove('token');
        Cookies.remove('userName');
        Cookies.remove('userEmail');
        window.location.href = 'login.html';
    }

    // Close user menu when clicking outside
    document.addEventListener('click', function(event) {
        const userMenu = document.getElementById('userMenu');
        const loginBtn = document.getElementById('loginBtn');
        if (userMenu && loginBtn && !userMenu.contains(event.target) && event.target !== loginBtn) {
            userMenu.style.display = 'none';
        }
    });

    let cityData = null;
    let statesData = [];

    // Sanitize image URLs coming from the database: trim whitespace and remove newlines
    function sanitizeImageUrl(url) {
      if (!url || typeof url !== 'string') return '';
      // Remove surrounding whitespace and any newline characters that may have been introduced
      return url.replace(/\s+/g, ' ').trim();
    }

    // Fetch city data from API
    async function loadCityData(cityName) {
      try {
        console.log('Fetching city data for:', cityName);
        const response = await fetch(`/api/city/${encodeURIComponent(cityName)}`);
        if (response.ok) {
          cityData = await response.json();
          console.log('City data loaded:', cityData);
          updatePageWithCityData();
        } else {
          console.error('City not found, status:', response.status);
          const errorData = await response.json();
          console.error('Error details:', errorData);
        }
      } catch (error) {
        console.error('Error loading city:', error);
      }
    }

    // Update page with city-specific content
    function updatePageWithCityData() {
      if (!cityData) return;

      // Handle new data structure with popular_places array
      const placeData = cityData.popular_places && cityData.popular_places.length > 0 
        ? cityData.popular_places[0] 
        : cityData;

      // Update header
      document.querySelector('header h1').textContent = `Discover ${cityData.name}`;
      
      // Set description from history if available
      const historyText = placeData.history ? placeData.history.text : 
                         (cityData.description || 'Explore this amazing destination');
      document.querySelector('header p').textContent = historyText.substring(0, 200) + '...';

      // Update summary cards
      const cards = document.querySelectorAll('.cards .card');
      if (cards.length >= 4) {
        // History card
        cards[0].querySelector('p').textContent = placeData.history ? 
          placeData.history.text.substring(0, 100) + '...' : 'Rich heritage and culture';
        
        // Food card
        const cuisineText = placeData.localCuisine && placeData.localCuisine.length > 0 ?
          placeData.localCuisine[0].name.substring(0, 100) + '...' :
          `Taste local delicacies of ${cityData.name}`;
        cards[1].querySelector('p').textContent = cuisineText;
        
        // Activities card
        const activitiesText = placeData.activities && placeData.activities.length > 0 ?
          placeData.activities[0].name.substring(0, 100) + '...' :
          'Adventure awaits you here';
        cards[2].querySelector('p').textContent = activitiesText;
        
        // Safety card
        const safetyText = placeData.safetyTips && placeData.safetyTips.length > 0 ?
          placeData.safetyTips[0].tip.substring(0, 100) + '...' :
          'Travel safely and enjoy your trip';
        cards[3].querySelector('p').textContent = safetyText;
      }

      // Update sections
      const sections = document.querySelectorAll('.section');
      
      // Section 1: History
      if (sections[0] && placeData.history) {
        const img = sections[0].querySelector('img');
        if (img) {
          // Use fallback image if the original doesn't exist or is a placeholder
          if (placeData.history.image && !placeData.history.image.includes('yourbucket.com')) {
            img.src = sanitizeImageUrl(placeData.history.image);
          } else {
            img.src = 'https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=800&q=80';
          }
          img.alt = cityData.name + ' - History';
          img.onerror = function() {
            this.src = 'https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=800&q=80';
          };
        }
        const text = sections[0].querySelector('.text p');
        if (text) {
          text.textContent = placeData.history.text;
        }
      }

      // Section 2: Food
      if (sections[1] && placeData.localCuisine) {
        const img = sections[1].querySelector('img');
        if (img) {
          if (placeData.localCuisine[0] && placeData.localCuisine[0].image && !placeData.localCuisine[0].image.includes('yourbucket.com')) {
            img.src = sanitizeImageUrl(placeData.localCuisine[0].image);
          } else {
            img.src = 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80';
          }
          img.alt = cityData.name + ' - Food';
          img.onerror = function() {
            this.src = 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80';
          };
        }
        const text = sections[1].querySelector('.text');
        if (text && placeData.localCuisine.length > 0) {
          text.querySelector('p').textContent = placeData.localCuisine[0].name;
        }
      }

      // Section 3: Adventure/Activities
      if (sections[2] && placeData.activities) {
        const img = sections[2].querySelector('img');
        if (img) {
          if (placeData.activities[0] && placeData.activities[0].image && !placeData.activities[0].image.includes('yourbucket.com')) {
            img.src = sanitizeImageUrl(placeData.activities[0].image);
          } else {
            img.src = 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=80';
          }
          img.alt = cityData.name + ' - Adventure';
          img.onerror = function() {
            this.src = 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=80';
          };
        }
        const text = sections[2].querySelector('.text');
        if (text && placeData.activities.length > 0) {
          text.querySelector('p').textContent = placeData.activities[0].name;
        }
      }

      // Section 4: Safety
      if (sections[3] && placeData.safetyTips) {
        const img = sections[3].querySelector('img');
        if (img) {
          img.alt = cityData.name + ' - Safety';
          img.onerror = function() {
            this.src = 'https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&w=800&q=80';
          };
        }
        const text = sections[3].querySelector('.text');
        if (text) {
          const safetyList = placeData.safetyTips.map(tip => `‚Ä¢ ${tip.tip}`).join('\n');
          text.querySelector('p').textContent = safetyList;
        }
      }

      // Section 5: Nearby Attractions
      if (sections[4] && placeData.nearbyAttractions) {
        const img = sections[4].querySelector('img');
        if (img) {
          if (placeData.nearbyAttractions[0] && placeData.nearbyAttractions[0].image && !placeData.nearbyAttractions[0].image.includes('yourbucket.com')) {
            img.src = sanitizeImageUrl(placeData.nearbyAttractions[0].image);
          } else {
            img.src = 'https://images.unsplash.com/photo-1539650116574-75c0c6d35fd8?auto=format&fit=crop&w=800&q=80';
          }
          img.alt = cityData.name + ' - Attractions';
          img.onerror = function() {
            this.src = 'https://images.unsplash.com/photo-1539650116574-75c0c6d35fd8?auto=format&fit=crop&w=800&q=80';
          };
        }
        const text = sections[4].querySelector('.text');
        if (text && placeData.nearbyAttractions.length > 0) {
          text.querySelector('p').textContent = placeData.nearbyAttractions[0].name;
        }
      }

      // Populate Popular Places Section
      const popularList = document.getElementById('popularPlacesList');
      const hiddenList = document.getElementById('hiddenPlacesList');
      
      console.log('City data for places:', { cityData, hasPopular: cityData.popular_places?.length, hasHidden: cityData.hidden_places?.length });
      
      if (popularList) {
        if (cityData.popular_places && cityData.popular_places.length > 0) {
          popularList.innerHTML = '';
          cityData.popular_places.forEach(place => {
            const placeCard = createPlaceCard(place, 'popular');
            popularList.appendChild(placeCard);
          });
          console.log('Popular places populated:', cityData.popular_places.length);
        } else {
          popularList.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-secondary);"><h3>No Popular Places Data Available</h3><p>Popular places information will be available soon for this destination.</p></div>';
        }
      }
      
      if (hiddenList) {
        if (cityData.hidden_places && cityData.hidden_places.length > 0) {
          hiddenList.innerHTML = '';
          cityData.hidden_places.forEach(place => {
            const placeCard = createPlaceCard(place, 'hidden');
            hiddenList.appendChild(placeCard);
          });
          console.log('Hidden places populated:', cityData.hidden_places.length);
        } else {
          hiddenList.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-secondary);"><h3>No Hidden Places Data Available</h3><p>Hidden gems information will be available soon for this destination.</p></div>';
        }
      }
      
      // Re-initialize buttons after data is loaded
      setTimeout(() => {
        initializeButtons();
      }, 100);
    }

    // Helper function to create detailed place cards
    function createPlaceCard(place, type) {
      const card = document.createElement('div');
      card.style.cssText = `
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 1.5rem;
        box-shadow: var(--shadow-lg);
        margin-bottom: 2rem;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      `;
      
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-5px)';
        card.style.boxShadow = '0 20px 50px rgba(0, 0, 0, 0.15)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
        card.style.boxShadow = 'var(--shadow-lg)';
      });

      // Function to get fallback image based on content type
      function getFallbackImage(contentType) {
        const fallbacks = {
          history: 'https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=800&q=80',
          cuisine: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80',
          activities: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=80',
          attractions: 'https://images.unsplash.com/photo-1539650116574-75c0c6d35fd8?auto=format&fit=crop&w=800&q=80',
          default: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80'
        };
        return fallbacks[contentType] || fallbacks.default;
      }

      // small helper to sanitize URLs when embedding into HTML
      const s = (u) => sanitizeImageUrl(u);

      let content = `<div style="padding: 2rem;">
        <h3 style="font-size: 1.8rem; margin-bottom: 1.5rem; color: var(--primary); font-weight: 600;">${place.name}</h3>`;

      // History Section
      if (place.history) {
        content += `
          <div style="margin-bottom: 2rem;">
            <h4 style="font-size: 1.3rem; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
              üèõÔ∏è History
            </h4>
            ${place.history.image && !place.history.image.includes('yourbucket.com') ? `<img src="${s(place.history.image)}" alt="${place.name} History" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;" onerror="this.src='${getFallbackImage('history')}'">` : `<img src="${getFallbackImage('history')}" alt="${place.name} History" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;">`}
            <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem;">${place.history.text}</p>
          </div>`;
      }

      // Local Cuisine Section
      if (place.localCuisine && place.localCuisine.length > 0) {
        content += `
          <div style="margin-bottom: 2rem;">
            <h4 style="font-size: 1.3rem; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
              üç≤ Local Cuisine
            </h4>`;
        place.localCuisine.forEach(cuisine => {
          content += `
            ${cuisine.image ? `<img src="${s(cuisine.image)}" alt="${cuisine.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;" onerror="this.src='${getFallbackImage('cuisine')}'">` : `<img src="${getFallbackImage('cuisine')}" alt="${cuisine.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;">`}
            <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem; margin-bottom: 1rem;">${cuisine.name}</p>`;
        });
        content += `</div>`;
      }

      // Activities Section
      if (place.activities && place.activities.length > 0) {
        content += `
          <div style="margin-bottom: 2rem;">
            <h4 style="font-size: 1.3rem; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
              üåÑ Activities
            </h4>`;
        place.activities.forEach(activity => {
          content += `
            ${activity.image ? `<img src="${s(activity.image)}" alt="${activity.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;" onerror="this.src='${getFallbackImage('activities')}'">` : `<img src="${getFallbackImage('activities')}" alt="${activity.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;">`}
            <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem; margin-bottom: 1rem;">${activity.name}</p>`;
        });
        content += `</div>`;
      }

      // Safety Tips Section
      if (place.safetyTips && place.safetyTips.length > 0) {
        content += `
          <div style="margin-bottom: 2rem;">
            <h4 style="font-size: 1.3rem; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
              üõ°Ô∏è Safety Tips
            </h4>
            <ul style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem; padding-left: 1.2rem;">`;
        place.safetyTips.forEach(tip => {
          content += `<li style="margin-bottom: 0.5rem;">${tip.tip}</li>`;
        });
        content += `</ul></div>`;
      }

      // Nearby Attractions Section
      if (place.nearbyAttractions && place.nearbyAttractions.length > 0) {
        content += `
          <div style="margin-bottom: 1rem;">
            <h4 style="font-size: 1.3rem; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
              üìç Nearby Attractions
            </h4>`;
        place.nearbyAttractions.forEach(attraction => {
          content += `
            ${attraction.image ? `<img src="${s(attraction.image)}" alt="${attraction.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;" onerror="this.src='${getFallbackImage('attractions')}'">` : `<img src="${getFallbackImage('attractions')}" alt="${attraction.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.7rem; margin-bottom: 1rem;">`}
            <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem; margin-bottom: 1rem;">${attraction.name}</p>`;
        });
        content += `</div>`;
      }

      content += `</div>`;
      card.innerHTML = content;
      return card;
    }

    // Fetch states data from API
    async function loadStates() {
      try {
        const response = await fetch('/api/states');
        statesData = await response.json();
        console.log('Loaded states:', statesData.length);
      } catch (error) {
        console.error('Error loading states:', error);
      }
    }

    // Update content dynamically based on URL parameters
    function updateContent() {
      const urlParams = new URLSearchParams(window.location.search);
      const cityName = urlParams.get('city');
      const stateName = urlParams.get('state');
      
      if (cityName) {
        // Load city-specific data
        loadCityData(cityName);
      } else if (stateName && statesData.length > 0) {
        const state = statesData.find(s => 
          s.name.toLowerCase() === stateName.toLowerCase()
        );
        
        if (state) {
          // Update page content with state-specific data
          document.querySelector('header h1').textContent = `Discover ${state.name}`;
          document.querySelector('header p').textContent = state.description;
          
          if (state.image) {
            const header = document.querySelector('header');
            if (header) {
              header.style.backgroundImage = `url('${state.image}')`;
            }
          }
        }
      }
    }

    function scrollToSection(num) {
      document.getElementById(`section${num}`).scrollIntoView({ behavior: 'smooth' });
    }

    function toggleMenu() {
      document.querySelector('.nav-links').classList.toggle('open');
    }

    const nav = document.querySelector('nav');
    window.addEventListener('scroll', () => {
      nav.classList.toggle('scrolled', window.scrollY > 50);
    });

    const sections = document.querySelectorAll('.section');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.2 });

    sections.forEach(section => observer.observe(section));
  </script>
</body>
</html>